<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="GainTracker" />
  <title>ğŸ’ª GainTracker</title>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; font-family: -apple-system, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #fff0f3 0%, #f0f4ff 50%, #f0fff4 100%); min-height: 100vh; }
    input, select, button { font-family: inherit; }
    input[type=number]::-webkit-inner-spin-button { opacity: 1; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script type="text/babel">
const { useState, useEffect, useRef } = React;

const COLORS = ["#FF6B6B","#FFD93D","#6BCB77","#4D96FF","#C77DFF","#FF9A3C","#00C9A7","#F72585"];
const SHORT_DAYS = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
const LOGS_DS  = "37633f57-0467-4623-b45b-f280395edd5a";
const PROGS_DS = "e10aed4f-e042-4a1e-b035-bfbda1aa0733";

function useLS(key, def) {
  const [v, setV] = useState(() => { try { const s = localStorage.getItem(key); return s ? JSON.parse(s) : def; } catch { return def; } });
  useEffect(() => { try { localStorage.setItem(key, JSON.stringify(v)); } catch {} }, [key, v]);
  return [v, setV];
}

async function notionCall(prompt) {
  const res = await fetch("https://api.anthropic.com/v1/messages", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "claude-sonnet-4-20250514",
      max_tokens: 1000,
      mcp_servers: [{ type: "url", url: "https://mcp.notion.com/mcp", name: "notion" }],
      messages: [{ role: "user", content: prompt }]
    })
  });
  return await res.json();
}

async function saveLogToNotion(log) {
  const exStr = log.type === "strength"
    ? (log.exercises||[]).map(ex => `${ex.name}: ${ex.sets.filter(s=>s.weight||s.reps).map(s=>`${s.weight||"?"}lbsÃ—${s.reps||"?"}`).join(", ")}`).join(" | ")
    : `${log.cardio.exercise} ${log.cardio.duration?log.cardio.duration+"min":""} ${log.cardio.distance?log.cardio.distance+" mi/km":""}`.trim();
  await notionCall(`Create a new page in Notion data source "${LOGS_DS}" with: Name="${log.type==="strength"?"ğŸ’ª Strength":"ğŸƒ Cardio"} â€” ${log.date}", Type="${log.type==="strength"?"Strength":"Cardio"}", date:Date:start="${log.date}", Exercises="${exStr}", Notes="${log.cardio?.notes||""}", Duration (min)=${log.cardio?.duration?Number(log.cardio.duration):0}, Distance="${log.cardio?.distance||""}", Program="${log.programName||""}", Program Day="${log.programDay||""}", Week="${log.week||""}". Confirm with SAVED.`);
}

async function saveProgramToNotion(prog) {
  await notionCall(`Create a new page in Notion data source "${PROGS_DS}" with: Name="${prog.name}", Description="${prog.description||""}", Schedule Type="${prog.scheduleType}", Active=${prog.active?"__YES__":"__NO__"}, Days JSON="${JSON.stringify(prog.days).replace(/"/g,'\\"')}". Confirm with SAVED.`);
}

// â”€â”€ TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Timer({ label, onClose }) {
  const [secs, setSecs] = useState(0);
  const [running, setRunning] = useState(false);
  const [preset, setPreset] = useState(null);
  const [cd, setCd] = useState(null);
  const ref = useRef(null);

  useEffect(() => {
    if (running) {
      ref.current = setInterval(() => {
        if (cd !== null) setCd(c => { if (c <= 1) { setRunning(false); clearInterval(ref.current); return 0; } return c-1; });
        else setSecs(s => s+1);
      }, 1000);
    } else clearInterval(ref.current);
    return () => clearInterval(ref.current);
  }, [running, cd]);

  const fmt = s => `${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;
  const startCd = s => { setCd(s); setPreset(s); setRunning(true); setSecs(0); };
  const display = cd !== null ? cd : secs;
  const prog = cd !== null && preset ? (1 - cd/preset)*100 : 0;

  return (
    <div style={{position:"fixed",top:70,right:12,zIndex:300,background:"white",borderRadius:20,padding:18,boxShadow:"0 8px 30px rgba(0,0,0,0.18)",minWidth:250}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
        <span style={{fontWeight:700,fontSize:14,color:"#333"}}>â± {label}</span>
        <button onClick={onClose} style={{background:"none",border:"none",fontSize:18,cursor:"pointer",color:"#aaa"}}>âœ•</button>
      </div>
      {cd !== null && <div style={{background:"#f0f0f0",borderRadius:8,height:6,marginBottom:10,overflow:"hidden"}}><div style={{height:"100%",background:"linear-gradient(90deg,#6BCB77,#4D96FF)",width:`${prog}%`,transition:"width 1s linear",borderRadius:8}}/></div>}
      <div style={{fontSize:48,fontWeight:800,textAlign:"center",color:cd!==null&&cd<10?"#FF6B6B":"#333",letterSpacing:2,marginBottom:12}}>{fmt(display)}</div>
      <div style={{display:"flex",gap:8,justifyContent:"center",marginBottom:10}}>
        <button onClick={()=>setRunning(r=>!r)} style={{padding:"8px 18px",borderRadius:30,border:"none",background:running?"#FFD93D":"#6BCB77",color:"#333",fontWeight:700,cursor:"pointer"}}>{running?"â¸ Pause":"â–¶ Start"}</button>
        <button onClick={()=>{setRunning(false);setSecs(0);setCd(null);setPreset(null);}} style={{padding:"8px 14px",borderRadius:30,border:"none",background:"#f0f0f0",color:"#333",fontWeight:700,cursor:"pointer"}}>â†º</button>
      </div>
      <div style={{display:"flex",gap:5,flexWrap:"wrap",justifyContent:"center"}}>
        {[30,60,90,120,180,300].map(s=>(
          <button key={s} onClick={()=>startCd(s)} style={{padding:"5px 9px",borderRadius:20,border:`2px solid ${preset===s?"#4D96FF":"#e0e0e0"}`,background:preset===s?"#4D96FF":"white",color:preset===s?"white":"#555",fontWeight:600,cursor:"pointer",fontSize:12}}>
            {s<60?`${s}s`:`${s/60}m`}
          </button>
        ))}
      </div>
    </div>
  );
}

// â”€â”€ PROGRAM EDITOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ProgramEditor({ prog, exercises, onSave, onCancel, saving }) {
  const [p, setP] = useState(prog || { name:"", description:"", scheduleType:"Both", active:false, days:[] });
  const [newDayName, setNewDayName] = useState("");
  const [newDayType, setNewDayType] = useState("strength");
  const [newDayDow, setNewDayDow] = useState([]);
  const strengthEx = exercises.filter(e=>e.type==="strength");
  const cardioEx   = exercises.filter(e=>e.type==="cardio");

  const addDay = () => {
    if (!newDayName.trim()) return;
    setP(pp=>({...pp,days:[...pp.days,{id:Date.now(),name:newDayName.trim(),type:newDayType,exercises:[],cardioExercise:"",dowDays:newDayDow}]}));
    setNewDayName(""); setNewDayDow([]);
  };
  const toggleExInDay = (dayId, exName) => setP(pp=>({...pp,days:pp.days.map(d=>d.id!==dayId?d:{...d,exercises:d.exercises.includes(exName)?d.exercises.filter(e=>e!==exName):[...d.exercises,exName]})}));
  const toggleDow = dow => setNewDayDow(prev=>prev.includes(dow)?prev.filter(d=>d!==dow):[...prev,dow]);

  return (
    <div style={{background:"white",borderRadius:20,padding:18,boxShadow:"0 4px 20px rgba(0,0,0,0.1)"}}>
      <h3 style={{margin:"0 0 14px",color:"#333"}}>{prog?.id?"Edit Program":"New Program"}</h3>
      {[["Program Name","name"],["Description (optional)","description"]].map(([lbl,field])=>(
        <div key={field} style={{marginBottom:12}}>
          <label style={{fontWeight:700,color:"#555",fontSize:13,display:"block",marginBottom:4}}>{lbl}</label>
          <input value={p[field]} onChange={e=>setP(pp=>({...pp,[field]:e.target.value}))} style={{width:"100%",padding:"9px 12px",borderRadius:12,border:"2px solid #e0e0e0",fontSize:14}}/>
        </div>
      ))}
      <div style={{marginBottom:14}}>
        <label style={{fontWeight:700,color:"#555",fontSize:13,display:"block",marginBottom:6}}>Schedule Type</label>
        <div style={{display:"flex",gap:8}}>
          {["Days of Week","Cycle","Both"].map(t=>(
            <button key={t} onClick={()=>setP(pp=>({...pp,scheduleType:t}))} style={{flex:1,padding:"7px 6px",borderRadius:20,border:`2px solid ${p.scheduleType===t?"#4D96FF":"#e0e0e0"}`,background:p.scheduleType===t?"#4D96FF":"white",color:p.scheduleType===t?"white":"#555",fontWeight:600,cursor:"pointer",fontSize:11}}>
              {t}
            </button>
          ))}
        </div>
      </div>

      {p.days.length > 0 && (
        <div style={{marginBottom:14}}>
          <label style={{fontWeight:700,color:"#555",fontSize:13,display:"block",marginBottom:8}}>Workout Days</label>
          {p.days.map(day=>(
            <div key={day.id} style={{background:"#f8f8f8",borderRadius:14,padding:12,marginBottom:10,borderLeft:`4px solid ${day.type==="strength"?"#FF6B6B":"#4D96FF"}`}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                <div>
                  <span style={{fontWeight:700,color:"#333",fontSize:14}}>{day.name}</span>
                  {day.dowDays?.length>0&&<span style={{marginLeft:6,fontSize:11,color:"#4D96FF",fontWeight:600}}>{day.dowDays.map(d=>SHORT_DAYS[d]).join(", ")}</span>}
                </div>
                <button onClick={()=>setP(pp=>({...pp,days:pp.days.filter(d=>d.id!==day.id)}))} style={{background:"none",border:"none",color:"#FF6B6B",cursor:"pointer",fontSize:15}}>âœ•</button>
              </div>
              {day.type==="strength" ? (
                <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
                  {strengthEx.map(ex=>(
                    <button key={ex.id} onClick={()=>toggleExInDay(day.id,ex.name)} style={{padding:"4px 10px",borderRadius:15,border:`2px solid ${ex.color}`,background:day.exercises.includes(ex.name)?ex.color:"white",color:day.exercises.includes(ex.name)?"white":ex.color,fontWeight:600,cursor:"pointer",fontSize:12}}>
                      {ex.name}
                    </button>
                  ))}
                </div>
              ) : (
                <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
                  {cardioEx.map(ex=>(
                    <button key={ex.id} onClick={()=>setP(pp=>({...pp,days:pp.days.map(d=>d.id===day.id?{...d,cardioExercise:ex.name}:d)}))} style={{padding:"4px 10px",borderRadius:15,border:`2px solid ${ex.color}`,background:day.cardioExercise===ex.name?ex.color:"white",color:day.cardioExercise===ex.name?"white":ex.color,fontWeight:600,cursor:"pointer",fontSize:12}}>
                      {ex.name}
                    </button>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      )}

      <div style={{background:"#f0f4ff",borderRadius:14,padding:14,marginBottom:14}}>
        <p style={{fontWeight:700,color:"#4D96FF",margin:"0 0 10px",fontSize:13}}>+ Add Workout Day</p>
        <input placeholder="Day name (e.g. Push Day, Leg Day)" value={newDayName} onChange={e=>setNewDayName(e.target.value)} style={{width:"100%",padding:"8px 12px",borderRadius:10,border:"2px solid #dde5ff",fontSize:13,marginBottom:8}}/>
        <div style={{display:"flex",gap:8,marginBottom:8}}>
          {["strength","cardio"].map(t=>(
            <button key={t} onClick={()=>setNewDayType(t)} style={{flex:1,padding:"7px",borderRadius:12,border:`2px solid ${newDayType===t?"#4D96FF":"#dde5ff"}`,background:newDayType===t?"#4D96FF":"white",color:newDayType===t?"white":"#555",fontWeight:600,cursor:"pointer",fontSize:12}}>
              {t==="strength"?"ğŸ‹ï¸ Strength":"ğŸƒ Cardio"}
            </button>
          ))}
        </div>
        {(p.scheduleType==="Days of Week"||p.scheduleType==="Both")&&(
          <div style={{marginBottom:8}}>
            <p style={{fontSize:12,color:"#777",margin:"0 0 6px",fontWeight:600}}>Assign to days:</p>
            <div style={{display:"flex",gap:5,flexWrap:"wrap"}}>
              {SHORT_DAYS.map((d,i)=>(
                <button key={i} onClick={()=>toggleDow(i)} style={{padding:"4px 10px",borderRadius:12,border:`2px solid ${newDayDow.includes(i)?"#4D96FF":"#dde5ff"}`,background:newDayDow.includes(i)?"#4D96FF":"white",color:newDayDow.includes(i)?"white":"#555",fontWeight:600,cursor:"pointer",fontSize:12}}>
                  {d}
                </button>
              ))}
            </div>
          </div>
        )}
        <button onClick={addDay} style={{width:"100%",padding:8,borderRadius:12,border:"none",background:"#4D96FF",color:"white",fontWeight:700,cursor:"pointer",fontSize:13}}>Add Day</button>
      </div>

      <div style={{display:"flex",gap:10}}>
        <button onClick={onCancel} style={{flex:1,padding:12,borderRadius:15,border:"2px solid #e0e0e0",background:"white",color:"#777",fontWeight:700,cursor:"pointer"}}>Cancel</button>
        <button onClick={()=>onSave(p)} disabled={!p.name||saving} style={{flex:2,padding:12,borderRadius:15,border:"none",background:"linear-gradient(90deg,#6BCB77,#4D96FF)",color:"white",fontWeight:800,cursor:"pointer",opacity:(!p.name||saving)?0.6:1}}>
          {saving?"Saving...":"ğŸ’¾ Save Program"}
        </button>
      </div>
    </div>
  );
}

// â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TABS = ["Today","Log","Programs","History","Exercises","Progress"];
const DEFAULT_EXERCISES = [
  {id:1,name:"Squat",type:"strength",color:"#FF6B6B"},
  {id:2,name:"Deadlift",type:"strength",color:"#FFD93D"},
  {id:3,name:"Bench Press",type:"strength",color:"#6BCB77"},
  {id:4,name:"Pull-up",type:"strength",color:"#4D96FF"},
  {id:5,name:"Overhead Press",type:"strength",color:"#C77DFF"},
  {id:6,name:"Romanian Deadlift",type:"strength",color:"#FF9A3C"},
  {id:7,name:"Running",type:"cardio",color:"#00C9A7"},
  {id:8,name:"Cycling",type:"cardio",color:"#F72585"},
];

function App() {
  const [tab, setTab] = useState(0);
  const [exercises, setExercises] = useLS("gt_exercises", DEFAULT_EXERCISES);
  const [logs, setLogs] = useLS("gt_logs", []);
  const [programs, setPrograms] = useLS("gt_programs", []);
  const [timer, setTimer] = useState(null);
  const [saving, setSaving] = useState(false);
  const [toast, setToast] = useState(null);
  const [editProg, setEditProg] = useState(null);
  const [progEx, setProgEx] = useState(null);
  const [newExName, setNewExName] = useState("");
  const [newExType, setNewExType] = useState("strength");

  const blankSession = () => ({ type:null, date:new Date().toISOString().slice(0,10), exercises:[], cardio:{exercise:"",duration:"",distance:"",notes:""}, programName:"", programDay:"" });
  const [session, setSession] = useState(blankSession);

  const showToast = (msg, color="#6BCB77") => { setToast({msg,color}); setTimeout(()=>setToast(null),3000); };
  const strengthEx = exercises.filter(e=>e.type==="strength");
  const cardioEx   = exercises.filter(e=>e.type==="cardio");

  const weekNum = () => { const d=new Date(),s=new Date(d.getFullYear(),0,1); return Math.ceil(((d-s)/86400000+s.getDay()+1)/7); };
  const currentWeek = `${new Date().getFullYear()}-W${String(weekNum()).padStart(2,"0")}`;
  const todayDOW = new Date().getDay();
  const todayStr = new Date().toISOString().slice(0,10);

  const activeProgram = programs.find(p=>p.active);
  const todayPlan = activeProgram?.days?.find(d=>d.dowDays?.includes(todayDOW)) || null;
  const logsThisWeek = logs.filter(l=>l.week===currentWeek);
  const completedDays = new Set(logsThisWeek.map(l=>l.programDay).filter(Boolean));

  const startFromPlan = plan => {
    const exObjs = (plan.exercises||[]).map(name=>{
      const ex=exercises.find(e=>e.name===name)||{id:Date.now()+Math.random(),name,type:"strength",color:"#4D96FF"};
      return {...ex,sets:[{weight:"",reps:""}]};
    });
    setSession({type:plan.type||"strength",date:todayStr,exercises:exObjs,cardio:{exercise:plan.cardioExercise||"",duration:"",distance:"",notes:""},programName:activeProgram?.name||"",programDay:plan.name});
    setTab(1);
  };

  const addExToSession = ex => { if(session.exercises.find(e=>e.id===ex.id))return; setSession(s=>({...s,exercises:[...s.exercises,{...ex,sets:[{weight:"",reps:""}]}]})); };
  const updateSet = (ei,si,ns) => setSession(s=>{ const ex=[...s.exercises]; ex[ei]={...ex[ei],sets:ex[ei].sets.map((st,i)=>i===si?ns:st)}; return {...s,exercises:ex}; });
  const addSet = ei => setSession(s=>{ const ex=[...s.exercises]; ex[ei]={...ex[ei],sets:[...ex[ei].sets,{weight:"",reps:""}]}; return {...s,exercises:ex}; });
  const removeSet = (ei,si) => setSession(s=>{ const ex=[...s.exercises]; ex[ei]={...ex[ei],sets:ex[ei].sets.filter((_,i)=>i!==si)}; return {...s,exercises:ex}; });
  const removeEx  = ei => setSession(s=>({...s,exercises:s.exercises.filter((_,i)=>i!==ei)}));

  const saveSession = async () => {
    setSaving(true);
    const log = {...session, id:Date.now(), week:currentWeek};
    setLogs(prev=>[log,...prev]);
    try { await saveLogToNotion(log); showToast("âœ… Saved to Notion!"); } catch { showToast("âš ï¸ Saved locally â€” Notion sync failed","#FF9A3C"); }
    setSession(blankSession());
    setSaving(false);
    setTab(0);
  };

  const saveProgram = async prog => {
    setSaving(true);
    if (prog.id) {
      setPrograms(prev=>prev.map(p=>p.id===prog.id?prog:p));
      showToast("âœ… Program updated!");
    } else {
      const np = {...prog, id:Date.now()};
      setPrograms(prev=>[...prev,np]);
      try { await saveProgramToNotion(np); showToast("âœ… Program saved to Notion!"); } catch { showToast("Saved locally","#FFD93D"); }
    }
    setEditProg(null);
    setSaving(false);
  };

  const getProgress = exId => {
    const pts=[];
    [...logs].reverse().forEach(log=>{ const ex=log.exercises?.find(e=>e.id===exId); if(ex){ const best=ex.sets.reduce((b,s)=>{ const v=parseFloat(s.weight)||0; return v>b?v:b; },0); pts.push({date:log.date,weight:best}); } });
    return pts;
  };

  const addExercise = () => { if(!newExName.trim())return; setExercises(prev=>[...prev,{id:Date.now(),name:newExName.trim(),type:newExType,color:COLORS[prev.length%COLORS.length]}]); setNewExName(""); };

  const s = { // shared styles
    card: {background:"white",borderRadius:16,padding:16,marginBottom:12,boxShadow:"0 2px 10px rgba(0,0,0,0.06)"},
    btn: (bg,color="#white")=>({border:"none",borderRadius:30,padding:"8px 18px",background:bg,color,fontWeight:700,cursor:"pointer",fontSize:14}),
    tag: (color)=>({padding:"5px 12px",borderRadius:18,border:`2px solid ${color}`,fontWeight:700,cursor:"pointer",fontSize:13}),
  };

  return (
    <div style={{minHeight:"100vh",paddingBottom:90}}>
      {/* Header */}
      <div style={{background:"white",boxShadow:"0 2px 15px rgba(0,0,0,0.07)",padding:"14px 18px",position:"sticky",top:0,zIndex:100}}>
        <div style={{maxWidth:620,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div>
            <h1 style={{margin:0,fontSize:21,fontWeight:800,background:"linear-gradient(90deg,#FF6B6B,#4D96FF)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>ğŸ’ª GainTracker</h1>
            <p style={{margin:0,fontSize:11,color:"#aaa"}}>Synced to Notion</p>
          </div>
          <button onClick={()=>setTimer(timer?null:"General")} style={{background:timer?"#FFD93D":"#f0f0f0",border:"none",borderRadius:20,padding:"7px 13px",fontWeight:700,cursor:"pointer",fontSize:13}}>â± Timer</button>
        </div>
      </div>

      {timer && <Timer label={timer} onClose={()=>setTimer(null)}/>}
      {toast && <div style={{position:"fixed",bottom:90,left:"50%",transform:"translateX(-50%)",background:toast.color,color:"white",padding:"10px 22px",borderRadius:25,fontWeight:700,fontSize:14,zIndex:500,boxShadow:"0 4px 20px rgba(0,0,0,0.2)",whiteSpace:"nowrap"}}>{toast.msg}</div>}

      <div style={{maxWidth:620,margin:"0 auto",padding:"16px 14px"}}>
        {/* Tabs */}
        <div style={{display:"flex",gap:3,marginBottom:16,background:"white",borderRadius:20,padding:4,boxShadow:"0 2px 10px rgba(0,0,0,0.07)",overflowX:"auto"}}>
          {TABS.map((t,i)=>(
            <button key={i} onClick={()=>setTab(i)} style={{flex:1,minWidth:52,padding:"7px 3px",borderRadius:15,border:"none",background:tab===i?"linear-gradient(90deg,#FF6B6B,#4D96FF)":"transparent",color:tab===i?"white":"#777",fontWeight:700,cursor:"pointer",fontSize:11,whiteSpace:"nowrap"}}>
              {t}
            </button>
          ))}
        </div>

        {/* TODAY */}
        {tab===0&&(
          <div>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
              <div>
                <h2 style={{margin:0,color:"#333",fontSize:18}}>Today ğŸ‘‹</h2>
                <p style={{margin:0,color:"#aaa",fontSize:13}}>{new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}</p>
              </div>
              {activeProgram&&<div style={{background:"#f0f4ff",borderRadius:12,padding:"5px 11px",fontSize:12,fontWeight:700,color:"#4D96FF"}}>{activeProgram.name}</div>}
            </div>
            {activeProgram&&(
              <div style={s.card}>
                <p style={{margin:"0 0 10px",fontWeight:700,color:"#555",fontSize:13}}>This week</p>
                <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:10}}>
                  {(activeProgram.days||[]).map(day=>(
                    <div key={day.id} style={{padding:"5px 11px",borderRadius:12,background:completedDays.has(day.name)?"#6BCB77":"#f0f0f0",color:completedDays.has(day.name)?"white":"#777",fontWeight:600,fontSize:12}}>
                      {completedDays.has(day.name)?"âœ“ ":""}{day.name}
                    </div>
                  ))}
                </div>
                <div style={{background:"#f0f0f0",borderRadius:8,height:6,overflow:"hidden"}}>
                  <div style={{height:"100%",background:"linear-gradient(90deg,#6BCB77,#4D96FF)",width:`${Math.round(completedDays.size/Math.max(activeProgram.days?.length||1,1)*100)}%`,borderRadius:8}}/>
                </div>
                <p style={{margin:"5px 0 0",fontSize:11,color:"#aaa"}}>{completedDays.size} / {activeProgram.days?.length||0} days done</p>
              </div>
            )}
            {todayPlan ? (
              <div style={{...s.card,border:"2px solid #4D96FF",boxShadow:"0 4px 20px rgba(77,150,255,0.15)"}}>
                <p style={{margin:"0 0 5px",fontWeight:800,color:"#4D96FF",fontSize:15}}>ğŸ“‹ Today: {todayPlan.name}</p>
                <p style={{margin:"0 0 10px",color:"#888",fontSize:13}}>{todayPlan.type==="strength"?"ğŸ‹ï¸ Strength":"ğŸƒ Cardio"} Â· {todayPlan.exercises?.length||0} exercises</p>
                {todayPlan.exercises?.length>0&&(
                  <div style={{display:"flex",flexWrap:"wrap",gap:6,marginBottom:12}}>
                    {todayPlan.exercises.map(e=>{ const ex=exercises.find(x=>x.name===e)||{color:"#aaa"}; return <span key={e} style={{padding:"4px 10px",borderRadius:10,background:`${ex.color}22`,color:ex.color,fontWeight:600,fontSize:12}}>{e}</span>; })}
                  </div>
                )}
                <button onClick={()=>startFromPlan(todayPlan)} style={{width:"100%",padding:12,borderRadius:15,border:"none",background:"linear-gradient(90deg,#4D96FF,#C77DFF)",color:"white",fontWeight:800,fontSize:15,cursor:"pointer"}}>â–¶ Start Today's Workout</button>
              </div>
            ) : (
              <div style={{...s.card,textAlign:"center"}}>
                <p style={{color:"#aaa",marginBottom:12}}>{activeProgram?"Rest day or no workout scheduled ğŸ‰":"No active program â€” set one up in Programs!"}</p>
                <button onClick={()=>setTab(1)} style={{padding:"10px 22px",borderRadius:15,border:"none",background:"linear-gradient(90deg,#FF6B6B,#FFD93D)",color:"white",fontWeight:700,cursor:"pointer"}}>+ Log a Workout Anyway</button>
              </div>
            )}
            {logs.slice(0,3).length>0&&(
              <div>
                <p style={{fontWeight:700,color:"#555",fontSize:13,marginBottom:8}}>Recent:</p>
                {logs.slice(0,3).map(log=>(
                  <div key={log.id} style={{...s.card,padding:12,display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                    <div>
                      <span style={{fontWeight:700,color:log.type==="strength"?"#FF6B6B":"#4D96FF",fontSize:14}}>{log.type==="strength"?"ğŸ‹ï¸ Strength":"ğŸƒ Cardio"}</span>
                      {log.programDay&&<span style={{marginLeft:8,fontSize:11,color:"#aaa"}}>{log.programDay}</span>}
                    </div>
                    <span style={{color:"#aaa",fontSize:12}}>{log.date}</span>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* LOG */}
        {tab===1&&(
          <div>
            {!session.type?(
              <div>
                <h2 style={{textAlign:"center",color:"#333",marginBottom:20}}>What are we doing? ğŸ¯</h2>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14}}>
                  {[{type:"strength",emoji:"ğŸ‹ï¸",label:"Strength",color:"#FF6B6B",bg:"#fff0f0"},{type:"cardio",emoji:"ğŸƒ",label:"Cardio",color:"#4D96FF",bg:"#f0f4ff"}].map(o=>(
                    <button key={o.type} onClick={()=>setSession(ss=>({...ss,type:o.type}))} style={{padding:"28px 16px",borderRadius:20,border:`3px solid ${o.color}`,background:o.bg,cursor:"pointer",textAlign:"center"}}>
                      <div style={{fontSize:38,marginBottom:6}}>{o.emoji}</div>
                      <div style={{fontWeight:800,color:o.color,fontSize:15}}>{o.label}</div>
                    </button>
                  ))}
                </div>
              </div>
            ):session.type==="strength"?(
              <div>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
                  <div>
                    <h2 style={{margin:0,fontSize:17,color:"#333"}}>ğŸ‹ï¸ Strength</h2>
                    <input type="date" value={session.date} onChange={e=>setSession(ss=>({...ss,date:e.target.value}))} style={{border:"none",background:"none",color:"#aaa",fontSize:12,cursor:"pointer"}}/>
                  </div>
                  <button onClick={()=>setSession(blankSession())} style={{background:"#f0f0f0",border:"none",borderRadius:12,padding:"6px 12px",cursor:"pointer",color:"#777",fontWeight:600,fontSize:12}}>â†© Back</button>
                </div>
                {session.programDay&&<div style={{background:"#f0f4ff",borderRadius:12,padding:"7px 13px",marginBottom:10,fontSize:13,fontWeight:600,color:"#4D96FF"}}>ğŸ“‹ {session.programDay}</div>}
                <div style={{...s.card,padding:12,marginBottom:10}}>
                  <p style={{margin:"0 0 8px",fontWeight:700,color:"#555",fontSize:12}}>Add exercises:</p>
                  <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
                    {strengthEx.map(ex=>{ const added=!!session.exercises.find(e=>e.id===ex.id); return <button key={ex.id} onClick={()=>addExToSession(ex)} style={{...s.tag(ex.color),background:added?ex.color:"white",color:added?"white":ex.color,padding:"4px 11px",fontSize:12}}>{added?"âœ“ ":""}{ex.name}</button>; })}
                  </div>
                </div>
                {session.exercises.map((ex,ei)=>(
                  <div key={ex.id} style={{...s.card,borderLeft:`4px solid ${ex.color}`,padding:14}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
                      <span style={{fontWeight:800,color:ex.color,fontSize:14}}>{ex.name}</span>
                      <div style={{display:"flex",gap:5}}>
                        <button onClick={()=>setTimer(`${ex.name} Rest`)} style={{background:"#fff0f0",border:"none",borderRadius:10,padding:"4px 8px",cursor:"pointer",fontSize:11,color:"#FF6B6B",fontWeight:600}}>â˜• Rest</button>
                        <button onClick={()=>setTimer(ex.name)} style={{background:"#f0f4ff",border:"none",borderRadius:10,padding:"4px 8px",cursor:"pointer",fontSize:11,color:"#4D96FF",fontWeight:600}}>â±</button>
                        <button onClick={()=>removeEx(ei)} style={{background:"none",border:"none",color:"#ccc",cursor:"pointer",fontSize:15}}>âœ•</button>
                      </div>
                    </div>
                    {ex.sets.map((set,si)=>(
                      <div key={si} style={{display:"flex",gap:6,alignItems:"center",marginBottom:6}}>
                        <span style={{width:20,color:"#bbb",fontSize:12,fontWeight:600}}>#{si+1}</span>
                        <input type="number" placeholder="lbs" value={set.weight} onChange={e=>updateSet(ei,si,{...set,weight:e.target.value})} style={{width:56,padding:"6px 6px",borderRadius:10,border:"2px solid #e0e0e0",fontSize:13,textAlign:"center"}}/>
                        <span style={{color:"#aaa",fontSize:11}}>lbs</span>
                        <input type="number" placeholder="reps" value={set.reps} onChange={e=>updateSet(ei,si,{...set,reps:e.target.value})} style={{width:52,padding:"6px 6px",borderRadius:10,border:"2px solid #e0e0e0",fontSize:13,textAlign:"center"}}/>
                        <span style={{color:"#aaa",fontSize:11}}>reps</span>
                        <button onClick={()=>removeSet(ei,si)} style={{background:"none",border:"none",color:"#FF6B6B",cursor:"pointer",fontSize:14}}>âœ•</button>
                      </div>
                    ))}
                    <button onClick={()=>addSet(ei)} style={{marginTop:4,padding:"4px 12px",borderRadius:12,border:`2px dashed ${ex.color}`,background:"transparent",color:ex.color,fontWeight:700,cursor:"pointer",fontSize:12}}>+ Set</button>
                  </div>
                ))}
                {session.exercises.length>0&&<button onClick={saveSession} disabled={saving} style={{width:"100%",padding:14,borderRadius:18,border:"none",background:"linear-gradient(90deg,#6BCB77,#4D96FF)",color:"white",fontWeight:800,fontSize:15,cursor:"pointer",marginTop:4,opacity:saving?0.7:1}}>{saving?"Saving...":"ğŸ’¾ Save Workout"}</button>}
              </div>
            ):(
              <div>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
                  <div>
                    <h2 style={{margin:0,fontSize:17,color:"#333"}}>ğŸƒ Cardio</h2>
                    <input type="date" value={session.date} onChange={e=>setSession(ss=>({...ss,date:e.target.value}))} style={{border:"none",background:"none",color:"#aaa",fontSize:12,cursor:"pointer"}}/>
                  </div>
                  <button onClick={()=>setSession(blankSession())} style={{background:"#f0f0f0",border:"none",borderRadius:12,padding:"6px 12px",cursor:"pointer",color:"#777",fontWeight:600,fontSize:12}}>â†© Back</button>
                </div>
                {session.programDay&&<div style={{background:"#f0f4ff",borderRadius:12,padding:"7px 13px",marginBottom:10,fontSize:13,fontWeight:600,color:"#4D96FF"}}>ğŸ“‹ {session.programDay}</div>}
                <div style={s.card}>
                  <div style={{marginBottom:12}}>
                    <label style={{fontWeight:700,color:"#555",fontSize:13,display:"block",marginBottom:6}}>Activity</label>
                    <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
                      {cardioEx.map(ex=><button key={ex.id} onClick={()=>setSession(ss=>({...ss,cardio:{...ss.cardio,exercise:ex.name}}))} style={{...s.tag(ex.color),background:session.cardio.exercise===ex.name?ex.color:"white",color:session.cardio.exercise===ex.name?"white":ex.color}}>{ex.name}</button>)}
                    </div>
                  </div>
                  {[["Duration (min)","duration","e.g. 30"],["Distance (mi/km)","distance","e.g. 3.1"],["Notes","notes","How did it feel?"]].map(([lbl,field,ph])=>(
                    <div key={field} style={{marginBottom:12}}>
                      <label style={{fontWeight:700,color:"#555",fontSize:13,display:"block",marginBottom:4}}>{lbl}</label>
                      <div style={{display:"flex",gap:8,alignItems:"center"}}>
                        <input placeholder={ph} value={session.cardio[field]} onChange={e=>setSession(ss=>({...ss,cardio:{...ss.cardio,[field]:e.target.value}}))} style={{flex:1,padding:"9px 12px",borderRadius:10,border:"2px solid #e0e0e0",fontSize:13}}/>
                        {field==="duration"&&<button onClick={()=>setTimer("Cardio")} style={{background:"#f0f4ff",border:"none",borderRadius:10,padding:"8px 10px",cursor:"pointer",fontSize:13,color:"#4D96FF",fontWeight:600}}>â±</button>}
                      </div>
                    </div>
                  ))}
                  <button onClick={saveSession} disabled={saving} style={{width:"100%",padding:13,borderRadius:16,border:"none",background:"linear-gradient(90deg,#FF9A3C,#FF6B6B)",color:"white",fontWeight:800,fontSize:15,cursor:"pointer",opacity:saving?0.7:1}}>{saving?"Saving...":"ğŸ’¾ Save Cardio"}</button>
                </div>
              </div>
            )}
          </div>
        )}

        {/* PROGRAMS */}
        {tab===2&&(
          <div>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
              <h2 style={{margin:0,color:"#333"}}>ğŸ“… Programs</h2>
              {!editProg&&<button onClick={()=>setEditProg({})} style={{padding:"8px 16px",borderRadius:15,border:"none",background:"linear-gradient(90deg,#C77DFF,#4D96FF)",color:"white",fontWeight:700,cursor:"pointer",fontSize:13}}>+ New</button>}
            </div>
            {editProg!==null?(
              <ProgramEditor prog={editProg.id?editProg:null} exercises={exercises} onSave={saveProgram} onCancel={()=>setEditProg(null)} saving={saving}/>
            ):programs.length===0?(
              <div style={{textAlign:"center",padding:40,color:"#aaa"}}><div style={{fontSize:48,marginBottom:10}}>ğŸ“‹</div><p>No programs yet! Build your first workout plan.</p></div>
            ):programs.map(prog=>(
              <div key={prog.id} style={{...s.card,border:prog.active?"2px solid #6BCB77":"2px solid transparent"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8}}>
                  <div>
                    <h3 style={{margin:0,color:"#333",fontSize:15}}>{prog.name}</h3>
                    {prog.description&&<p style={{margin:"2px 0 0",color:"#aaa",fontSize:12}}>{prog.description}</p>}
                    <span style={{fontSize:11,color:"#C77DFF",fontWeight:600}}>{prog.scheduleType}</span>
                  </div>
                  <div style={{display:"flex",gap:6,alignItems:"center"}}>
                    <button onClick={()=>setPrograms(prev=>prev.map(p=>({...p,active:p.id===prog.id?!p.active:false})))} style={{padding:"5px 10px",borderRadius:12,border:"none",background:prog.active?"#6BCB77":"#f0f0f0",color:prog.active?"white":"#777",fontWeight:700,cursor:"pointer",fontSize:12}}>{prog.active?"âœ“ Active":"Activate"}</button>
                    <button onClick={()=>setEditProg(prog)} style={{background:"none",border:"none",color:"#4D96FF",cursor:"pointer",fontSize:13,fontWeight:600}}>Edit</button>
                    <button onClick={()=>setPrograms(prev=>prev.filter(p=>p.id!==prog.id))} style={{background:"none",border:"none",color:"#FF6B6B",cursor:"pointer",fontSize:14}}>âœ•</button>
                  </div>
                </div>
                <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
                  {(prog.days||[]).map(day=>(
                    <div key={day.id} style={{padding:"4px 10px",borderRadius:10,background:day.type==="strength"?"#fff0f0":"#f0f4ff",color:day.type==="strength"?"#FF6B6B":"#4D96FF",fontSize:12,fontWeight:600}}>
                      {day.type==="strength"?"ğŸ‹ï¸":"ğŸƒ"} {day.name}{day.dowDays?.length>0?` (${day.dowDays.map(d=>SHORT_DAYS[d]).join(",")})` :""}
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        )}

        {/* HISTORY */}
        {tab===3&&(
          <div>
            <h2 style={{color:"#333",marginTop:0}}>ğŸ“… History</h2>
            {logs.length===0?<div style={{textAlign:"center",padding:40,color:"#aaa"}}><div style={{fontSize:48}}>ğŸ“­</div><p>No workouts yet!</p></div>
            :logs.map(log=>(
              <div key={log.id} style={s.card}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <span style={{fontWeight:800,fontSize:14,color:log.type==="strength"?"#FF6B6B":"#4D96FF"}}>{log.type==="strength"?"ğŸ‹ï¸ Strength":"ğŸƒ Cardio"}</span>
                  <span style={{color:"#aaa",fontSize:12}}>{log.date}</span>
                </div>
                {log.programDay&&<span style={{fontSize:11,color:"#4D96FF",fontWeight:600,background:"#f0f4ff",borderRadius:8,padding:"2px 8px",display:"inline-block",marginBottom:6}}>{log.programDay}</span>}
                {log.type==="strength"?log.exercises?.map((ex,i)=>(
                  <div key={i} style={{marginBottom:4}}><span style={{fontWeight:700,color:ex.color,fontSize:13}}>{ex.name}</span><span style={{color:"#888",fontSize:12,marginLeft:6}}>{ex.sets.filter(s=>s.weight||s.reps).map(s=>`${s.weight||"?"}Ã—${s.reps||"?"}`).join(", ")}</span></div>
                )):(
                  <div style={{color:"#555",fontSize:13}}>
                    {log.cardio?.exercise&&<span style={{fontWeight:700}}>{log.cardio.exercise} </span>}
                    {log.cardio?.duration&&<span>{log.cardio.duration}min </span>}
                    {log.cardio?.distance&&<span>Â· {log.cardio.distance} </span>}
                    {log.cardio?.notes&&<span style={{color:"#aaa"}}>Â· {log.cardio.notes}</span>}
                  </div>
                )}
                <button onClick={()=>setLogs(prev=>prev.filter(l=>l.id!==log.id))} style={{marginTop:6,background:"none",border:"none",color:"#FF6B6B",fontSize:12,cursor:"pointer",fontWeight:600}}>ğŸ—‘ Delete</button>
              </div>
            ))}
          </div>
        )}

        {/* EXERCISES */}
        {tab===4&&(
          <div>
            <h2 style={{color:"#333",marginTop:0}}>ğŸ·ï¸ My Exercises</h2>
            <div style={s.card}>
              <p style={{fontWeight:700,color:"#555",margin:"0 0 10px",fontSize:13}}>Add exercise:</p>
              <div style={{display:"flex",gap:8,marginBottom:8}}>
                <input placeholder="Name" value={newExName} onChange={e=>setNewExName(e.target.value)} onKeyDown={e=>e.key==="Enter"&&addExercise()} style={{flex:1,padding:"9px 12px",borderRadius:10,border:"2px solid #e0e0e0",fontSize:13}}/>
                <select value={newExType} onChange={e=>setNewExType(e.target.value)} style={{padding:"9px 10px",borderRadius:10,border:"2px solid #e0e0e0",fontSize:13,background:"white"}}>
                  <option value="strength">ğŸ’ª Strength</option>
                  <option value="cardio">ğŸƒ Cardio</option>
                </select>
              </div>
              <button onClick={addExercise} style={{width:"100%",padding:9,borderRadius:12,border:"none",background:"linear-gradient(90deg,#6BCB77,#4D96FF)",color:"white",fontWeight:700,cursor:"pointer",fontSize:13}}>+ Add</button>
            </div>
            {["strength","cardio"].map(type=>(
              <div key={type}>
                <h3 style={{color:type==="strength"?"#FF6B6B":"#4D96FF",marginBottom:8,fontSize:14}}>{type==="strength"?"ğŸ‹ï¸ Strength":"ğŸƒ Cardio"}</h3>
                <div style={{display:"flex",flexWrap:"wrap",gap:7,marginBottom:14}}>
                  {exercises.filter(e=>e.type===type).map(ex=>(
                    <div key={ex.id} style={{display:"flex",alignItems:"center",gap:5,padding:"6px 12px",borderRadius:18,border:`2px solid ${ex.color}`,background:"white"}}>
                      <span style={{fontWeight:700,color:ex.color,fontSize:13}}>{ex.name}</span>
                      <button onClick={()=>setExercises(prev=>prev.filter(e=>e.id!==ex.id))} style={{background:"none",border:"none",color:"#ccc",cursor:"pointer",fontSize:13,padding:0}}>âœ•</button>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        )}

        {/* PROGRESS */}
        {tab===5&&(
          <div>
            <h2 style={{color:"#333",marginTop:0}}>ğŸ“ˆ Progress</h2>
            <div style={{display:"flex",flexWrap:"wrap",gap:7,marginBottom:14}}>
              {strengthEx.map(ex=><button key={ex.id} onClick={()=>setProgEx(ex)} style={{...s.tag(ex.color),background:progEx?.id===ex.id?ex.color:"white",color:progEx?.id===ex.id?"white":ex.color,padding:"5px 12px",fontSize:12}}>{ex.name}</button>)}
            </div>
            {progEx&&(()=>{
              const pts=getProgress(progEx.id);
              if(!pts.length) return <div style={{textAlign:"center",padding:30,color:"#aaa"}}>No data yet for {progEx.name}</div>;
              const max=Math.max(...pts.map(p=>p.weight))||1, min=Math.min(...pts.map(p=>p.weight));
              return (
                <div style={s.card}>
                  <h3 style={{color:progEx.color,margin:"0 0 14px",fontSize:15}}>{progEx.name} â€” Top Weight / Session</h3>
                  <div style={{display:"flex",alignItems:"flex-end",gap:4,height:130,marginBottom:6}}>
                    {pts.map((pt,i)=>{ const h=max===min?80:((pt.weight-min)/(max-min))*100+15; return <div key={i} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:3}}><span style={{fontSize:9,color:"#555",fontWeight:700}}>{pt.weight}</span><div style={{width:"100%",height:`${h}%`,background:progEx.color,borderRadius:"5px 5px 0 0",opacity:0.8}}/></div>; })}
                  </div>
                  <div style={{display:"flex",justifyContent:"space-between",fontSize:10,color:"#aaa",marginBottom:12}}><span>{pts[0]?.date}</span><span>{pts[pts.length-1]?.date}</span></div>
                  <div style={{display:"flex",gap:8}}>
                    {[["Best",Math.max(...pts.map(p=>p.weight))+" lbs",progEx.color],["Sessions",pts.length,"#333"],["Latest",pts[pts.length-1]?.weight+" lbs","#6BCB77"]].map(([lbl,val,c])=>(
                      <div key={lbl} style={{flex:1,background:"#f9f9f9",borderRadius:12,padding:10,textAlign:"center"}}>
                        <div style={{fontWeight:800,color:c,fontSize:16}}>{val}</div>
                        <div style={{color:"#aaa",fontSize:11}}>{lbl}</div>
                      </div>
                    ))}
                  </div>
                </div>
              );
            })()}
            {!progEx&&<div style={{textAlign:"center",padding:30,color:"#aaa"}}>ğŸ‘† Select an exercise to view progress</div>}
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
